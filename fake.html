<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”° Kami Flex Fake Number ðŸ”°</title>
<style>
  body {background:#041427;color:#e6f3fb;font-family:sans-serif;padding:20px;}
  h1 {font-size:28px;margin-bottom:20px;}
  select,input,button {padding:10px;margin:5px;border-radius:8px;border:none;}
  select,input {min-width:180px;}
  button {cursor:pointer;background:#1fb6ff;color:#012;font-weight:bold;position:relative;}
  button.loading::after{
    content:'';
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    width:18px; height:18px; border:2px solid #012; border-top-color:#19c2ff;
    border-radius:50%; animation:spin 0.8s linear infinite;
  }
  @keyframes spin{0%{transform:translate(-50%,-50%) rotate(0deg);}100%{transform:translate(-50%,-50%) rotate(360deg);}}
  .row {padding:10px;margin:8px 0;border-radius:10px;background:rgba(255,255,255,0.05);}
  .number {font-weight:bold;}
  .otp {color:#7ef05d;font-weight:bold;}
  .country {color:#1fb6ff;}
  .error {color:#ff4d4f;font-weight:bold;margin-top:10px;}
</style>
</head>
<body>

<h1>ðŸ”° Kami Flex Fake Number ðŸ”°</h1>

<select id="countrySelect"><option>Loading countries...</option></select>
<select id="carrierSelect"><option>Loading carriers...</option></select>
<button id="getBtn">Get Number</button>
<button id="generateBtn">Generate</button>

<div id="rows"></div>
<div id="errorMsg" class="error"></div>

<script>
const countrySelect = document.getElementById('countrySelect');
const carrierSelect = document.getElementById('carrierSelect');
const getBtn = document.getElementById('getBtn');
const generateBtn = document.getElementById('generateBtn');
const rowsEl = document.getElementById('rows');
const errorMsg = document.getElementById('errorMsg');

// --- Load countries from API ---
async function loadCountries() {
  try {
    const res = await fetch('/api/fake.js?type=countries');
    if(!res.ok) throw new Error(`API ${res.status} - ${res.statusText}`);
    const data = await res.json();
    countrySelect.innerHTML = '';
    data.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.code; // API code
      opt.textContent = c.name; // full country name
      countrySelect.appendChild(opt);
    });
  } catch(e) {
    countrySelect.innerHTML = '<option>Error loading countries</option>';
    errorMsg.textContent = 'Error loading countries: ' + e.message;
  }
}

// --- Load carriers from API ---
async function loadCarriers() {
  try {
    const res = await fetch('/api/fake.js?type=carriers');
    if(!res.ok) throw new Error(`API ${res.status} - ${res.statusText}`);
    const data = await res.json();
    carrierSelect.innerHTML = '';
    data.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      carrierSelect.appendChild(opt);
    });
  } catch(e) {
    carrierSelect.innerHTML = '<option>Error loading carriers</option>';
    errorMsg.textContent = 'Error loading carriers: ' + e.message;
  }
}

// --- Fetch number ---
async function fetchNumber() {
  errorMsg.textContent = '';
  const country = countrySelect.value;
  const carrier = carrierSelect.value;
  getBtn.classList.add('loading');
  generateBtn.classList.add('loading');
  try {
    const res = await fetch(`/api/fake.js?type=number&app=global--${country}-01&carrier=${carrier}`);
    if(!res.ok) throw new Error(`API ${res.status} - ${res.statusText}`);
    const data = await res.json();
    const number = data.number || 'N/A';
    const otp = data.otp || Math.floor(1000 + Math.random()*9000);
    const countryName = countrySelect.options[countrySelect.selectedIndex].text;
    renderRow({number, otp, country: countryName, carrier});
  } catch(e) {
    errorMsg.textContent = 'Error fetching number: ' + e.message;
  } finally {
    getBtn.classList.remove('loading');
    generateBtn.classList.remove('loading');
  }
}

// --- Render row ---
function renderRow(item){
  const div = document.createElement('div'); div.className='row';
  div.innerHTML = `<div class="number">${item.number}</div>
                   <div class="otp">${item.otp}</div>
                   <div class="country">${item.country} / ${item.carrier}</div>`;
  rowsEl.prepend(div);
}

// --- Event listeners ---
getBtn.addEventListener('click', fetchNumber);
generateBtn.addEventListener('click', fetchNumber);

// --- Initial load ---
loadCountries();
loadCarriers();

</script>
</body>
</html>
