<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kami Flex Temp Mail</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#fff; margin:0; padding:20px; }
    .container { max-width:800px; margin:auto; background:#1e293b; padding:20px; border-radius:10px; }
    h1 { margin-top:0; color:#38bdf8; }
    button { background:#38bdf8; border:none; padding:10px 16px; margin:5px; border-radius:6px; cursor:pointer; }
    button.secondary { background:transparent; border:1px solid #38bdf8; color:#38bdf8; }
    #emailBox { margin:10px 0; font-weight:bold; }
    #inbox { list-style:none; padding:0; margin-top:15px; }
    #inbox li { padding:8px; border-bottom:1px solid #334155; cursor:pointer; }
    #messageContent { margin-top:15px; padding:12px; background:#0f172a; border-radius:6px; min-height:100px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“§ Kami Flex Temp Mail</h1>
    <div>
      <button id="generateBtn">Generate Email</button>
      <button id="copyBtn" class="secondary">Copy</button>
      <span id="emailBox">No email generated</span>
    </div>
    <div>
      <button id="refreshBtn">Refresh Inbox</button>
      <button id="clearBtn" class="secondary">Clear</button>
    </div>

    <h3>ðŸ“¥ Inbox</h3>
    <ul id="inbox"><li>No messages yet</li></ul>

    <h3>ðŸ“¨ Message</h3>
    <div id="messageContent">Message content will appear here...</div>
  </div>

<script>
let currentEmail = "";

// Generate Email
document.getElementById("generateBtn").onclick = async () => {
  const res = await fetch("/api?op=generate");
  const data = await res.json();
  if(data.email){
    currentEmail = data.email;
    document.getElementById("emailBox").innerText = currentEmail;
    navigator.clipboard.writeText(currentEmail).catch(()=>{});
    loadInbox();
  }
};

// Copy Email
document.getElementById("copyBtn").onclick = () => {
  if(currentEmail){
    navigator.clipboard.writeText(currentEmail);
    alert("Copied: " + currentEmail);
  } else {
    alert("Generate email first!");
  }
};

// Clear
document.getElementById("clearBtn").onclick = () => {
  currentEmail = "";
  document.getElementById("emailBox").innerText = "No email generated";
  document.getElementById("inbox").innerHTML = "<li>No messages</li>";
  document.getElementById("messageContent").innerText = "Message content will appear here...";
};

// Refresh
document.getElementById("refreshBtn").onclick = () => loadInbox();

// Load Inbox
async function loadInbox(){
  if(!currentEmail) return alert("Generate email first!");
  const res = await fetch("/api?op=inbox&email="+encodeURIComponent(currentEmail));
  const data = await res.json();
  const inbox = document.getElementById("inbox");
  inbox.innerHTML = "";
  if(data.length === 0){
    inbox.innerHTML = "<li>No messages</li>";
  } else {
    data.forEach(msg=>{
      const li = document.createElement("li");
      li.innerText = `From: ${msg.from} â€” Subject: ${msg.subject}`;
      li.onclick = ()=> loadMessage(msg.id);
      inbox.appendChild(li);
    });
  }
}

// Load Single Message
async function loadMessage(id){
  const res = await fetch("/api?op=message&email="+encodeURIComponent(currentEmail)+"&messageid="+encodeURIComponent(id));
  const data = await res.json();
  document.getElementById("messageContent").innerText = data.text || data.body || "No content";
}
</script>
</body>
</html>
