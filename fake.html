<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kami Flex ‚Äî Fake Number / OTP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small customizations */
    .animated-text {
      background: linear-gradient(270deg,#7e22ce,#db2777,#f59e0b,#10b981);
      background-size: 800% 800%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientMove 6s ease infinite;
      font-family: "Poppins", sans-serif;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); }
    .card-grad { background: linear-gradient(90deg, rgba(99,102,241,0.12), rgba(236,72,153,0.08)); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 text-gray-900 font-sans">

  <!-- NAV -->
  <header class="sticky top-0 z-50">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="h-12 w-12 rounded-full bg-gradient-to-tr from-purple-500 via-pink-500 to-yellow-400 flex items-center justify-center shadow-lg">
          <img src="images/logo.png" alt="Kami Flex" class="h-9 w-9 rounded-full object-cover" onerror="this.style.display='none'">
        </div>
        <h1 class="text-2xl font-extrabold animated-text">Kami Flex</h1>
      </div>

      <div class="flex items-center gap-3">
        <button id="backBtn" class="px-3 py-2 rounded-lg bg-white/80 shadow hover:bg-white">‚¨Ö Back</button>
        <button id="copyAllBtn" class="px-3 py-2 rounded-lg bg-purple-600 text-white shadow hover:opacity-90">Copy Last</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-5xl mx-auto px-6 py-10">
    <section class="glass rounded-2xl p-8 shadow-xl border border-white/10 card-grad">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold mb-1">üì± Fake Number & OTP</h2>
          <p class="text-sm text-gray-700/80 max-w-xl">Use the Raazit proxy to request a temporary number or view OTP entries. No country/carrier selection ‚Äî one-click calls to `/api/fake`.</p>
        </div>

        <div class="flex gap-3">
          <button id="getNumber" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-pink-500 to-yellow-400 text-white font-semibold rounded-2xl shadow hover:scale-105 transform transition">Get Number</button>
          <button id="getOtp" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white font-semibold rounded-2xl shadow hover:scale-105 transform transition">Get OTP</button>
        </div>
      </div>

      <!-- status / instructions -->
      <div id="status" class="mt-6 text-sm text-gray-700/90">
        Click <strong>Get Number</strong> to request a number (calls `?type=number`). Click <strong>Get OTP</strong> to list OTPs (calls `?type=otp`).
      </div>

      <!-- loading -->
      <div id="loader" class="mt-6 hidden flex items-center gap-3 text-sm text-gray-700">
        <svg class="animate-spin h-6 w-6 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
        <div id="loaderText">Loading‚Ä¶</div>
      </div>

      <!-- error -->
      <div id="error" class="mt-6 hidden text-red-600 font-semibold"></div>

      <!-- result area -->
      <div id="results" class="mt-6 grid gap-4"></div>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto px-6 py-6 text-center text-sm text-gray-600">
    Kami Flex ‚Ä¢ ¬© <span id="yr"></span>
  </footer>

<script>
  // small helpers & state
  const apiBase = '/api/fake'; // expects vercel function at this path
  let lastResultText = '';

  document.getElementById('yr').innerText = new Date().getFullYear();
  const loader = document.getElementById('loader');
  const loaderText = document.getElementById('loaderText');
  const errorEl = document.getElementById('error');
  const results = document.getElementById('results');

  document.getElementById('backBtn').addEventListener('click', () => {
    // go back to index if present, else history.back()
    if (location.pathname.endsWith('fake-ui.html')) {
      location.href = 'index.html';
    } else {
      history.back();
    }
  });

  document.getElementById('copyAllBtn').addEventListener('click', () => {
    if (!lastResultText) {
      alert('Nothing to copy yet.');
      return;
    }
    navigator.clipboard.writeText(lastResultText)
      .then(()=> alert('Copied last result to clipboard'))
      .catch(()=> alert('Copy failed'));
  });

  document.getElementById('getNumber').addEventListener('click', () => callApi('number'));
  document.getElementById('getOtp').addEventListener('click', () => callApi('otp'));

  async function callApi(type) {
    clearUI();
    showLoader('Requesting ' + (type==='number' ? 'number' : 'OTP list') + ' ‚Ä¶');

    try {
      const resp = await fetch(`${apiBase}?type=${encodeURIComponent(type)}`, { method: 'GET' });
      // non-OK -> show useful message
      if (!resp.ok) {
        const text = await resp.text().catch(()=>null);
        throw new Error(`${resp.status} ${resp.statusText}${text ? ' ‚Äî ' + text : ''}`);
      }

      // try parse JSON, fallback to text
      let data;
      const contentType = resp.headers.get('content-type') || '';
      if (contentType.includes('application/json')) {
        data = await resp.json();
      } else {
        const txt = await resp.text();
        try { data = JSON.parse(txt); } catch { data = txt; }
      }

      renderResult(type, data);

    } catch (err) {
      showError('‚ùå Failed to fetch: ' + (err.message || err));
    } finally {
      hideLoader();
    }
  }

  function showLoader(text='Loading‚Ä¶') {
    loaderText.innerText = text;
    loader.classList.remove('hidden');
  }
  function hideLoader() { loader.classList.add('hidden'); }

  function showError(msg) {
    errorEl.innerText = msg;
    errorEl.classList.remove('hidden');
  }

  function clearUI() {
    errorEl.classList.add('hidden');
    errorEl.innerText = '';
    results.innerHTML = '';
  }

  function renderResult(type, data) {
    // pretty formatting depending on data type
    lastResultText = typeof data === 'string' ? data : JSON.stringify(data, null, 2);

    // header card
    const header = document.createElement('div');
    header.className = 'p-4 rounded-xl glass border border-white/6 flex items-start gap-4';
    header.innerHTML = `
      <div class="flex-1">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-bold">${type === 'number' ? 'Number Response' : 'OTP Response'}</h3>
            <p class="text-sm text-gray-700/80">Raw result from <code>/api/fake?type=${type}</code></p>
          </div>
          <div class="text-sm text-gray-600">Time: ${new Date().toLocaleTimeString()}</div>
        </div>
      </div>
    `;
    results.appendChild(header);

    // If data is an array or object, show cards for keys / items
    if (Array.isArray(data)) {
      if (data.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'p-4 rounded-lg bg-white/5 text-center text-sm text-gray-700';
        empty.innerText = 'No items returned.';
        results.appendChild(empty);
      } else {
        data.forEach((item, idx) => {
          const c = makeCard(item, idx+1);
          results.appendChild(c);
        });
      }
    } else if (typeof data === 'object' && data !== null) {
      // if contains records array use it (the upstream earlier used data.records)
      if (data.records && Array.isArray(data.records)) {
        if (data.records.length === 0) {
          const empty = document.createElement('div');
          empty.className = 'p-4 rounded-lg bg-white/5 text-center text-sm text-gray-700';
          empty.innerText = 'No records found.';
          results.appendChild(empty);
        } else {
          data.records.forEach((r, i) => results.appendChild(makeCard(r, i+1)));
        }
      } else {
        // single object: show key/values
        results.appendChild(makeCard(data));
      }
    } else {
      // plain string or unknown
      const pre = document.createElement('pre');
      pre.className = 'p-4 rounded-lg bg-black/40 text-sm text-white overflow-auto';
      pre.innerText = typeof data === 'string' ? data : String(data);
      results.appendChild(pre);
    }

    // add action row: copy / download JSON
    const actions = document.createElement('div');
    actions.className = 'mt-3 flex gap-3';
    actions.innerHTML = `
      <button id="copyBtn" class="px-4 py-2 rounded-lg bg-purple-600 text-white shadow">üìã Copy JSON</button>
      <button id="downloadBtn" class="px-4 py-2 rounded-lg bg-white/90">‚¨á Download</button>
    `;
    results.appendChild(actions);

    document.getElementById('copyBtn').addEventListener('click', () => {
      navigator.clipboard.writeText(lastResultText)
        .then(()=> alert('JSON copied'))
        .catch(()=> alert('Copy failed'));
    });

    document.getElementById('downloadBtn').addEventListener('click', () => {
      const blob = new Blob([lastResultText], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${type}-response-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
  }

  function makeCard(item, idx) {
    const card = document.createElement('div');
    card.className = 'p-4 rounded-xl bg-white/5 border border-white/6';
    if (typeof item === 'string' || typeof item === 'number') {
      card.innerHTML = `<div class="font-medium">#${idx ?? ''}</div><pre class="mt-2 text-sm text-white">${item}</pre>`;
      return card;
    }
    // show key-values
    let html = `<div class="flex items-center justify-between"><div class="font-semibold">#${idx ?? ''}</div><div class="text-xs text-gray-500">object</div></div><div class="mt-3 grid gap-2">`;
    Object.keys(item).forEach(k => {
      const v = item[k] === null ? 'null' : (typeof item[k] === 'object' ? JSON.stringify(item[k]) : String(item[k]));
      html += `<div class="flex justify-between items-start gap-3 p-2 bg-black/20 rounded">
                 <div class="text-sm text-gray-200 font-medium">${escapeHtml(k)}</div>
                 <div class="text-sm text-gray-100 break-words text-right">${escapeHtml(v)}</div>
               </div>`;
    });
    html += `</div>`;
    card.innerHTML = html;
    return card;
  }

  // tiny HTML escape
  function escapeHtml(s) {
    return String(s)
      .replaceAll('&', '&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;');
  }

</script>
</body>
</html>
