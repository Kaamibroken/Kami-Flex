<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Temp Mail By Kami Flex</title>
  <script>
    async function generateMail() {
      document.getElementById("status").innerText = "⏳ Generating...";
      try {
        const res = await fetch("/api/tempmail?op=generate");
        const data = await res.json();
        if (data?.result?.email) {
          document.getElementById("email").innerText = data.result.email;
          document.getElementById("copyBtn").style.display = "inline-block";
          window.currentEmail = data.result.email;
          document.getElementById("status").innerText = "✅ Email generated";
        } else {
          document.getElementById("status").innerText = "❌ Failed";
        }
      } catch (err) {
        document.getElementById("status").innerText = "❌ Error: " + err.message;
      }
    }

    async function checkInbox() {
      if (!window.currentEmail) return alert("Generate email first!");
      document.getElementById("status").innerText = "📬 Checking inbox...";
      try {
        const res = await fetch(`/api/tempmail?op=inbox&email=${window.currentEmail}`);
        const data = await res.json();
        document.getElementById("inbox").innerText = JSON.stringify(data, null, 2);
        document.getElementById("status").innerText = "📥 Inbox loaded";
      } catch (err) {
        document.getElementById("status").innerText = "❌ Error: " + err.message;
      }
    }

    function copyEmail() {
      navigator.clipboard.writeText(window.currentEmail);
      alert("📋 Copied: " + window.currentEmail);
    }
  </script>
</head>
<body style="font-family: Arial; text-align: center; padding: 20px;">
  <h1>📧 Temp Mail By Kami Flex</h1>
  <button onclick="generateMail()">Generate Email</button>
  <p id="email" style="font-weight: bold; color: blue;"></p>
  <button id="copyBtn" onclick="copyEmail()" style="display:none;">Copy</button>
  <br><br>
  <button onclick="checkInbox()">Check Inbox</button>
  <pre id="inbox" style="text-align:left; background:#f4f4f4; padding:10px;"></pre>
  <p id="status"></p>
</body>
</html>
