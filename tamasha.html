<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kami Flex Tamasha ğŸ’™</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">

  <h1 class="text-3xl font-bold text-cyan-400 mb-6">ğŸ“º Kami Flex Tamasha</h1>

  <!-- Phone + OTP Section -->
  <div id="authSection" class="p-6 bg-gray-800 rounded-2xl shadow-lg w-96">
    <input id="phoneInput" type="text" placeholder="ğŸ“± Enter Mobile (03xxxxxxxxx)"
      class="w-full p-3 rounded-lg text-black mb-3" />
    <button onclick="sendOtp()"
      class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 rounded-lg">
      Send OTP
    </button>

    <div id="otpBox" class="hidden mt-4">
      <input id="otpInput" type="text" placeholder="ğŸ”‘ Enter OTP"
        class="w-full p-3 rounded-lg text-black mb-3" />
      <button onclick="verifyOtp()"
        class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg">
        Verify OTP
      </button>
    </div>

    <p id="authResult" class="mt-3 text-sm text-red-400"></p>
  </div>

  <!-- Packages Section -->
  <div id="packagesSection" class="hidden mt-6 w-full max-w-lg p-6 bg-gray-800 rounded-2xl shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-cyan-300">ğŸ Available Packages</h2>
    <div id="packagesList" class="space-y-3"></div>
  </div>

  <script>
    async function sendOtp() {
      const phone = document.getElementById("phoneInput").value;
      const res = await fetch(`/api/tamasha?action=send_otp`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone })
      });
      const data = await res.json();
      if (data.ok) {
        document.getElementById("authResult").innerText = "âœ… OTP Sent!";
        document.getElementById("otpBox").classList.remove("hidden");
      } else {
        document.getElementById("authResult").innerText = "âŒ Failed to send OTP";
      }
    }

    async function verifyOtp() {
      const phone = document.getElementById("phoneInput").value;
      const otp = document.getElementById("otpInput").value;
      const res = await fetch(`/api/tamasha?action=verify_otp`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone, otp })
      });
      const data = await res.json();
      if (data.ok) {
        document.getElementById("authResult").innerText = "âœ… OTP Verified!";
        document.getElementById("authSection").classList.add("hidden");
        document.getElementById("packagesSection").classList.remove("hidden");
        loadPackages();
      } else {
        document.getElementById("authResult").innerText = "âŒ Wrong OTP";
      }
    }

    async function loadPackages() {
      const list = document.getElementById("packagesList");
      list.innerHTML = "";

      try {
        const res = await fetch(`/api/tamasha?action=packages`);
        const data = await res.json();

        if (data.ok && data.data && data.data.length > 0) {
          data.data.forEach(pkg => {
            const div = document.createElement("div");
            div.className = "p-4 bg-gray-700 rounded-lg";
            div.innerText = `${pkg.name} - ${pkg.price}`;
            list.appendChild(div);
          });
        } else {
          showFallbackPackages();
        }
      } catch (err) {
        showFallbackPackages();
      }
    }

    function showFallbackPackages() {
      const list = document.getElementById("packagesList");
      list.innerHTML = "";

      const fallback = [
        { name: "1 Day Package", price: "Rs. 10/day" },
        { name: "7 Day Package", price: "Rs. 70/week" },
        { name: "30 Day Package", price: "Rs. 300/month" },
        { name: "Data Special", price: "Rs. 120/month" }
      ];

      fallback.forEach(pkg => {
        const div = document.createElement("div");
        div.className = "p-4 bg-gray-700 rounded-lg";
        div.innerText = `${pkg.name} - ${pkg.price}`;
        list.appendChild(div);
      });
    }
  </script>
</body>
</html>
