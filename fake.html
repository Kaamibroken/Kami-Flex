<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kami Flex Fake Number AF</title>
<style>
  :root {
    --bg: #071a2a;
    --card: rgba(255,255,255,0.05);
    --muted: #9aa4b2;
    --accent: #06b6d4;
    --copy: #b7ff6a;
  }
  body {
    margin:0; padding:0; font-family:sans-serif;
    background: linear-gradient(180deg,#071024,#071a2a);
    color:#e6eef6;
  }
  .container {
    max-width: 900px; margin:auto; padding:20px;
  }
  h1 {
    text-align:center; margin-bottom:10px; color:var(--accent);
  }
  .controls {
    display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;
  }
  button, select, input {
    padding:8px 12px;
    border-radius:6px;
    border:1px solid rgba(255,255,255,0.1);
    background:transparent;
    color:inherit;
    cursor:pointer;
  }
  button {
    background:var(--accent);
    color:#071a2a;
  }
  .card {
    background:var(--card); padding:12px; border-radius:10px; margin-bottom:15px;
  }
  .item {
    display:flex; justify-content:space-between; align-items:center;
    padding:8px; background:rgba(255,255,255,0.02); border-radius:6px; margin-bottom:5px;
  }
  .otp { font-weight:bold; color:var(--copy); margin-left:10px; }
  .copy { background:#173644; border:none; padding:5px 8px; cursor:pointer; border-radius:5px; }
  textarea { width:100%; height:120px; background:#02101a; border:none; border-radius:8px; padding:10px; color:#cfe8ea; resize:vertical; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
  <h1>Kami Flex Fake Number AF</h1>
  <div class="controls">
    <input type="text" id="appInput" placeholder="App ID" value="global--AF-93">
    <input type="text" id="carrierInput" placeholder="Carrier" value="619">
    <button id="generateBtn">Generate Number</button>
    <button id="refreshBtn">Refresh OTP</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="card">
    <h3>Generated Number</h3>
    <div id="numberDisplay" class="item">
      <span id="numberText">--</span>
      <button id="copyBtn" class="copy">Copy</button>
      <span id="otpText" class="otp">--</span>
    </div>
  </div>

  <textarea id="log" readonly placeholder="Logs & raw responses"></textarea>
</div>

<script>
const generateBtn = document.getElementById('generateBtn');
const refreshBtn = document.getElementById('refreshBtn');
const clearBtn = document.getElementById('clearBtn');
const numberText = document.getElementById('numberText');
const otpText = document.getElementById('otpText');
const copyBtn = document.getElementById('copyBtn');
const log = document.getElementById('log');
const appInput = document.getElementById('appInput');
const carrierInput = document.getElementById('carrierInput');

async function api(type, app, carrier){
  try {
    const params = new URLSearchParams({type, app, carrier});
    const res = await fetch('/api/fake?' + params.toString());
    const data = await res.json();
    return data;
  } catch(e){
    appendLog('API error: '+e.message);
    return null;
  }
}

function appendLog(msg){
  const ts = new Date().toLocaleTimeString();
  log.value = `[${ts}] ${msg}\n` + log.value;
}

generateBtn.addEventListener('click', async ()=>{
  appendLog('Generating number...');
  const app = appInput.value;
  const carrier = carrierInput.value;
  const data = await api('number', app, carrier);
  if(!data) return;
  // try pick number & id
  let number='', otp='';
  if(Array.isArray(data.data)){
    number = data.data[0]?.number || '--';
    otp = data.data[0]?.otp || '--';
  } else if(data.number){
    number = data.number;
    otp = data.otp || '--';
  }
  numberText.textContent = number;
  otpText.textContent = otp;
  appendLog('Number generated: ' + number);
});

refreshBtn.addEventListener('click', async ()=>{
  appendLog('Refreshing OTP...');
  const data = await api('otp');
  if(!data) return;
  let otpVal = '--';
  if(Array.isArray(data.data) && data.data[0]?.otp) otpVal = data.data[0].otp;
  else if(data.otp) otpVal = data.otp;
  otpText.textContent = otpVal;
  appendLog('OTP refreshed: '+otpVal);
});

clearBtn.addEventListener('click', ()=>{
  numberText.textContent = '--';
  otpText.textContent = '--';
  log.value = '';
});

copyBtn.addEventListener('click', async ()=>{
  try {
    await navigator.clipboard.writeText(numberText.textContent);
    copyBtn.textContent='Copied';
    setTimeout(()=>copyBtn.textContent='Copy',1200);
  } catch(e){
    appendLog('Copy failed');
  }
});
</script>
</body>
</html>
